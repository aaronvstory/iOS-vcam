# SRS Configuration - iPhone RTMP ULTRA-SMOOTH (Sub-Second Latency)
# Optimized for iPhone WiFi streaming with minimal buffering and maximum smoothness
# Target: <1 second total latency, butter-smooth playback

listen              192.168.50.9:1935;
max_connections     1000;
daemon              off;
srs_log_tank        console;

http_api {
    enabled         on;
    listen          192.168.50.9:1985;
}

http_server {
    enabled         on;
    listen          192.168.50.9:8080;
}

vhost __defaultVhost__ {
    # HLS optimized for iPhone (fallback option)
    hls {
        enabled         on;
        hls_fragment    1;      # 1-second fragments for ultra-low latency
        hls_window      3;      # Only 3 fragments = 3 seconds total
        hls_path        ./objs/nginx/html/[app]/;
        hls_m3u8_file   [app]/[stream].m3u8;
        hls_ts_file     [app]/[stream]-[seq].ts;
    }
    
    # HTTP-FLV for primary iPhone streaming (lowest latency)
    http_remux {
        enabled         on;
        mount           [vhost]/[app]/[stream].flv;
    }
    
    # ULTRA-LOW LATENCY network settings
    tcp_nodelay     on;         # Immediate TCP packet delivery
    min_latency     on;         # Enable ALL low-latency optimizations
    
    # AGGRESSIVE play settings for sub-second latency
    play {
        gop_cache       off;        # Disable GOP cache completely
        queue_length    1;          # MINIMUM possible buffer (was 3!)
        mw_latency      100;        # Target 100ms latency (was 200ms!)
        time_jitter     off;        # Disable jitter correction for speed
        mix_correct     off;        # Disable mix correction for speed
        atc             off;        # Disable ATC for minimal processing
        mw_msgs         1;          # Send immediately, don't batch
    }

    # Ultra-fast publish settings
    publish {
        parse_sps       on;         # Keep for iOS compatibility
        firstpkt_timeout 60000;     # Increase to 60 seconds for iOS compatibility
        normal_timeout  10000;      # Increase timeout for iOS
        mr              off;        # Disable merged read for speed
    }
    
    # Optimized chunk size for ultra-low latency
    chunk_size          4096;       # Smaller chunks for faster delivery
    
    # Minimal bandwidth buffering
    in_ack_size         250000;     # Small window for immediate response
    out_ack_size        250000;     # Match for consistency
    
    # Disable all unnecessary features for maximum speed
    refer {
        enabled         off;
    }
    refer_play {
        enabled         off;
    }
    refer_publish {
        enabled         off;
    }
    
    security {
        enabled         off;
    }
    
    forward {
        enabled         off;
    }
    
    dvr {
        enabled         off;
    }
}

