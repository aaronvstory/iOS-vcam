# SRS Configuration - iPhone RTMP Optimized for Maximum Smoothness
# Designed specifically for iOS RTMP clients with smoothness as top priority

listen              192.168.50.9:1935;
max_connections     1000;
daemon              off;
srs_log_tank        console;

http_api {
    enabled         on;
    listen          192.168.50.9:1985;
}

http_server {
    enabled         on;
    listen          192.168.50.9:8080;
}

vhost __defaultVhost__ {
    # HLS as backup (iOS loves HLS)
    hls {
        enabled         on;
        hls_fragment    1;      # Very short fragments for iOS
        hls_window      3;      # Minimal window for low latency
        hls_path        ./objs/nginx/html/[app]/;
        hls_m3u8_file   [app]/[stream].m3u8;
        hls_ts_file     [app]/[stream]-[seq].ts;
    }
    
    # iOS-optimized TCP and connection settings
    tcp_nodelay on;
    min_latency off;            # Allow buffering for maximum smoothness
    
    # Maximum smoothness play settings for iOS
    play {
        gop_cache on;           # Enable GOP cache for smoother iOS playback
        queue_length 15;        # Large buffer for iOS smoothness (increased from 10)
        mw_latency 1000;        # Allow 1 second latency for maximum smoothness
        time_jitter full;       # Allow timestamp correction for iOS
    }

    # iOS-friendly publish settings
    publish {
        parse_sps on;           # Parse SPS headers for iOS compatibility
        firstpkt_timeout 30000; # Very generous timeout for iOS (30 seconds)
        normal_timeout 10000;   # Longer normal timeout for iOS
    }
    
    # Additional iOS optimizations
    chunk_size 4096;            # Smaller RTMP chunks for iOS compatibility
    
    # Security settings (iOS can be picky about this)
    security {
        enabled off;
    }
    
    # Forward settings
    forward {
        enabled off;
    }
    
    # DVR settings (can help with buffering)
    dvr {
        enabled off;
    }
}

