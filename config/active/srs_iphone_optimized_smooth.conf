# SRS Configuration - iPhone RTMP Ultra-Smooth Optimized  
# Based on proven SRS 5.0.213 working directives only
# Optimized to eliminate choppy iPhone playback over WiFi

listen              192.168.50.9:1935;
max_connections     1000;
daemon              off;
srs_log_tank        console;

http_api {
    enabled         on;
    listen          192.168.50.9:1985;
}

http_server {
    enabled         on;
    listen          192.168.50.9:8080;
}

vhost __defaultVhost__ {
    # HLS configuration optimized for iPhone
    hls {
        enabled         on;
        hls_fragment    2;      # 2-second fragments for stability
        hls_window      4;      # 4 fragments = 8 seconds buffer
        hls_path        ./objs/nginx/html/[app]/;
        hls_m3u8_file   [app]/[stream].m3u8;
        hls_ts_file     [app]/[stream]-[seq].ts;
    }
    
    # HTTP-FLV for lower latency
    http_remux {
        enabled         on;
        mount           [vhost]/[app]/[stream].flv;
    }
    
    # Network optimizations proven to work
    tcp_nodelay     on;
    min_latency     on;
    
    # Optimized play settings for smooth iPhone playback
    play {
        gop_cache       off;        # Prevent artifacts
        queue_length    3;          # Minimal buffer (was 15!)
        mw_latency      200;        # Low latency target (was 1000ms!)
        time_jitter     careful;    # Conservative jitter handling
        mix_correct     on;         # Timestamp correction
        atc             on;         # Absolute Time Code
    }

    # Publish settings for mobile compatibility
    publish {
        parse_sps       on;         # iOS compatibility
        firstpkt_timeout 15000;     # 15 second timeout
        normal_timeout  5000;       # 5 second timeout
        mr              off;        # Disable merge read
    }
    
    # Chunk size optimization
    chunk_size          60000;      # Large chunks for efficiency
    
    # Bandwidth control
    in_ack_size         2500000;    # ~3Mbps window
    out_ack_size        2500000;    # Match bandwidth
    
    # Disable unnecessary features
    refer {
        enabled         off;
    }
    refer_play {
        enabled         off;
    }
    refer_publish {
        enabled         off;
    }
    
    security {
        enabled         off;
    }
    
    forward {
        enabled         off;
    }
    
    dvr {
        enabled         off;
    }
}

