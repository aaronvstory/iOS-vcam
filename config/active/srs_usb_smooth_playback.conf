# SRS Configuration - USB SMOOTH PLAYBACK (Delayed but Butter-Smooth)
# Optimized for maximum smoothness over USB, sacrificing latency for quality
# Target: 3-5 second delay, zero frame drops, silky smooth playback
# Use Case: Virtual camera where realtime isn't critical, smoothness is king

listen              1935;
max_connections     1000;
daemon              off;
srs_log_tank        console;

http_api {
    enabled         on;
    listen          1985;
}

http_server {
    enabled         on;
    listen          8080;
}

vhost __defaultVhost__ {
    # DISABLE HLS - Major CPU savings (~30%), not needed for VCAM RTMP
    hls {
        enabled         off;
    }

    # HTTP-FLV disabled - not needed for USB mode
    http_remux {
        enabled         off;
    }

    # SMOOTHNESS-FIRST network settings
    tcp_nodelay     off;        # Allow TCP buffering for smooth delivery
    min_latency     off;        # DISABLE aggressive low-latency mode

    # MAXIMUM SMOOTHNESS play settings
    play {
        gop_cache       on;         # Cache keyframes for instant smooth start
        queue_length    30;         # LARGE buffer (30 frames vs 1 before!)
        mw_latency      3000;       # Allow 3 SECOND delay for smoothness
        mw_msgs         8;          # Batch messages for efficiency
        time_jitter     full;       # Enable full jitter correction
        mix_correct     on;         # Enable mix correction for quality
        atc             off;        # Keep off for compatibility
    }

    # Relaxed publish settings - no rush
    publish {
        parse_sps       on;         # Keep for iOS compatibility
        firstpkt_timeout 30000;     # 30 second timeout (generous)
        normal_timeout  10000;      # 10 second timeout
        mr              on;         # Enable merged read for efficiency
        mr_latency      500;        # 500ms merge latency
    }

    # LARGE chunk size for efficiency - fewer packets = less CPU
    chunk_size          60000;      # Large chunks (was 4096)

    # Larger bandwidth windows for smooth streaming
    in_ack_size         2500000;    # Large window (10x default)
    out_ack_size        2500000;    # Match for consistency

    # Disable all unnecessary features for CPU savings
    refer {
        enabled         off;
    }
    refer_play {
        enabled         off;
    }
    refer_publish {
        enabled         off;
    }

    security {
        enabled         off;
    }

    forward {
        enabled         off;
    }

    dvr {
        enabled         off;
    }
}
