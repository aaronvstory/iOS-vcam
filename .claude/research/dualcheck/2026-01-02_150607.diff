commit 431793230982963ab01e28f63118413bdcef5051
Author: a <aaron.v.story@outlook.com>
Date:   Fri Jan 2 14:27:34 2026 -0800

    fix: address dualcheck review findings for jetsamctl
    
    Fixes identified by Gemini + Codex dual verification:
    
    HIGH:
    - Fixed SSHD PID lookup: removed grep -v filter that excluded valid sshd line
    - Fixed fragile PID detection: added numeric filter `$1 ~ /^[0-9]+$/`
    
    MEDIUM:
    - Added 82flex to TrollVNC pattern for alternate bundle IDs
    - Added #include <stdint.h> to embedded C source
    - Replaced atoi() with strtol() for proper PID validation
    
    LOW:
    - Using absolute path /var/jb/usr/bin/jetsamctl instead of relying on PATH
    
    ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
    
    Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>

diff --git a/iOS-VCAM-Launcher.ps1 b/iOS-VCAM-Launcher.ps1
index 594c362..e855e6d 100644
--- a/iOS-VCAM-Launcher.ps1
+++ b/iOS-VCAM-Launcher.ps1
@@ -2246,10 +2246,11 @@ perl -i -0777 -pe 's|(</dict>\s*</plist>)|<key>JetsamMemoryLimit</key>\n\t<integ
         # Compile jetsamctl from source (since it's not in repos)
         $compileCmd = @'
 cat > /tmp/jetsamctl.c << 'EOFC'
 #include <stdio.h>
 #include <stdlib.h>
+#include <stdint.h>
 #include <errno.h>
 #include <string.h>
 #include <unistd.h>
 #include <sys/sysctl.h>
 #define MEMORYSTATUS_CMD_SET_PRIORITY_PROPERTIES 7
@@ -2258,11 +2259,14 @@ typedef struct memorystatus_priority_properties { int32_t priority; uint64_t use
 int main(int argc, char *argv[]) {
     if (argc < 3) { printf("Usage: jetsamctl -p <priority> <pid>\n"); return 1; }
     int opt, priority = -1;
     while ((opt = getopt(argc, argv, "p:l:")) != -1) { if (opt == 'p') priority = atoi(optarg); }
     if (optind >= argc) { fprintf(stderr, "Expected PID\n"); return 1; }
-    pid_t pid = atoi(argv[optind]);
+    char *endptr; errno = 0;
+    long lpid = strtol(argv[optind], &endptr, 10);
+    if (errno || *endptr || lpid <= 0) { fprintf(stderr, "Invalid PID\n"); return 1; }
+    pid_t pid = (pid_t)lpid;
     if (priority >= 0) {
         memorystatus_priority_properties_t props = { .priority = priority, .user_data = 0 };
         if (memorystatus_control(MEMORYSTATUS_CMD_SET_PRIORITY_PROPERTIES, pid, 0, &props, sizeof(props)) != 0) {
             fprintf(stderr, "Failed: %s\n", strerror(errno)); return 1;
         }
@@ -2289,15 +2293,15 @@ cd /tmp && clang -o jetsamctl jetsamctl.c 2>&1 && ldid -S jetsamctl && cp jetsam
     # Apply runtime protection to TrollVNC and sshd (if jetsamctl exists now)
     # Use launchctl to find PIDs (pgrep not available on all jailbreaks)
     # Priority 18 = critical system daemon level (higher = less likely to be killed)
     Write-Host "  ðŸ›¡ï¸ Applying runtime jetsam protection..." -ForegroundColor Cyan
     $jetsamApplyCmd = @'
-VNC_PID=$(launchctl list 2>/dev/null | grep -i trollvnc | awk '{print $1}' | head -1)
-SSHD_PID=$(launchctl list 2>/dev/null | grep "com.openssh.sshd" | grep -v "com.openssh.sshd$" | awk '{print $1}' | head -1)
+VNC_PID=$(launchctl list 2>/dev/null | grep -iE 'trollvnc|82flex' | awk '$1 ~ /^[0-9]+$/ {print $1; exit}')
+SSHD_PID=$(launchctl list 2>/dev/null | grep 'com.openssh.sshd' | awk '$1 ~ /^[0-9]+$/ {print $1; exit}')
 VNC_OK=0; SSHD_OK=0
-if [ -n "$VNC_PID" ] && [ "$VNC_PID" != "-" ]; then jetsamctl -p 18 $VNC_PID 2>/dev/null && VNC_OK=1; fi
-if [ -n "$SSHD_PID" ] && [ "$SSHD_PID" != "-" ]; then jetsamctl -p 18 $SSHD_PID 2>/dev/null && SSHD_OK=1; fi
+if [ -n "$VNC_PID" ]; then /var/jb/usr/bin/jetsamctl -p 18 $VNC_PID 2>/dev/null && VNC_OK=1; fi
+if [ -n "$SSHD_PID" ]; then /var/jb/usr/bin/jetsamctl -p 18 $SSHD_PID 2>/dev/null && SSHD_OK=1; fi
 echo "VNC_PID=$VNC_PID VNC_OK=$VNC_OK SSHD_PID=$SSHD_PID SSHD_OK=$SSHD_OK"
 '@
     $jetsamApplyArgs = $plinkBaseArgs + @($jetsamApplyCmd)
     $jetsamResult = (& "$plinkPath" $jetsamApplyArgs 2>&1) | Out-String
 
